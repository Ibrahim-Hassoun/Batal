name: Laravel CI
on:
  push:
    branches:
      - main

jobs: 
  laravel:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.4'  
          extensions: mbstring, ctype, fileinfo, openssl, pdo, tokenizer, xml  
          coverage: none
          
      - name: Cache Composer packages
        uses: actions/cache@v3
        with:
          path: backend/vendor  
          key: ${{ runner.os }}-composer-${{ hashFiles('backend/composer.lock') }}  

      - name: Install dependencies
        run: composer install --no-interaction --prefer-dist
        working-directory: backend

      - name: Generate Laravel key
        run: php artisan key:generate --show  
        working-directory: backend

      # - name: Run Default Tests
      #   run: |
      #     cp .env.example .env.testing
      #     echo "APP_ENV=testing" >> .env.testing
      #     echo "SESSION_DRIVER=array" >> .env.testing  # ‚Üê Add this line
      #     php artisan key:generate --show
      #     php artisan test --env=testing
      #   working-directory: backend

      - name: Verify Laravel boot
        run: |
          php artisan serve --no-interaction &
          sleep 10  
          curl -I http://127.0.0.1:8000  
        working-directory: backend
